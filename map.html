<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0; padding: 0 }
  #map_canvas { height: 100% }
</style>
<script type="text/javascript"
    src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCY7q5a-tgPPvLAYPaaxdOeomitd8N7fJk&sensor=true">
</script>
<script type="application/json" id="trails">
{{ trails|safe }}
</script>
<script type="text/javascript">
  function initialize() {
    var myOptions = {
      zoom: 8,
      mapTypeId: google.maps.MapTypeId.TERRAIN
    };
    var map = new google.maps.Map(document.getElementById("map_canvas"),
        myOptions);

    var trailsJson = document.getElementById('trails').innerHTML;
    var trails = JSON.parse(trailsJson).response.trails;

    for (i = 0; i < trails.length; i++) {
      var kmlurl = trails[i].response.trail.kmlurl;
      var kml = new google.maps.KmlLayer(kmlurl);
      kml.setMap(map);
      kml.click = function() {
        alert(JSON.stringify(kml.getMetadata()));
      }
    }
  }
</script>
</head>
<body onload="initialize()">
  <div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>
